{"version":3,"file":"output.min.js","sources":["../src/output.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Open Educational Resources Plugin\n *\n * @author     Christian Ortner <christian.ortner@tugraz.at>\n * @copyright  2022 Educational Technologies, Graz, University of Technology\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport * as Service from 'local_oer/service';\nimport * as Templates from \"core/templates\";\nimport * as Config from \"local_oer/config\";\nimport * as ModalFactory from 'core/modal_factory';\nimport * as ModalEvents from 'core/modal_events';\nimport * as Fragment from 'core/fragment';\nimport * as Str from 'core/str';\n\n/**\n * Show the files in the browser.\n *\n * @param {boolean} init\n */\nexport const showFiles = (init) => {\n    let output = Config.getOutputValues(init);\n    let oldSearchInput = document.getElementById('local_oer_searchFilecardsInput');\n    let oldSearchValue = '';\n    if (oldSearchInput !== null) {\n        oldSearchValue = oldSearchInput.value;\n    }\n    Templates.render('local_oer/files', output)\n        .then(function(html, js) {\n            Templates.replaceNodeContents('#local-oer-overview', html, js);\n            let searchInput = document.getElementById('local_oer_searchFilecardsInput');\n            if (searchInput !== null) {\n                // Workaround to fix losing focus of search after Template.replaceNodeContents.\n                // The navigation controls are inside the template and replaced after every search.\n                searchInput.value = oldSearchValue;\n                searchInput.focus();\n            }\n            return; // For eslint.\n        }).fail(function(error) {\n        window.console.debug(error);\n    });\n    showPagination();\n};\n\n/**\n * Load a form from the backend and show it in a modal.\n *\n * @param {string} type\n * @param {string} title\n * @param {object} options\n */\nexport const showForm = (type, title, options) => {\n    let params = JSON.stringify(options);\n    let courseid = document.getElementById(\"local_oer_files_main_area\").dataset.courseid;\n    let context = document.getElementById(\"local_oer_files_main_area\").dataset.context;\n    let args = {\n        courseid: courseid,\n        formtype: type,\n        params: params,\n    };\n    let form = Fragment.loadFragment('local_oer', 'formdata', context, args);\n    form.done(function() {\n        showFormModal(form, type, title, options);\n    });\n};\n\n\nconst showFormModal = (form, type, title, options) => {\n    let element = document.getElementById(\"local_oer_files_main_area\");\n    ModalFactory.create({\n        type: ModalFactory.types.SAVE_CANCEL,\n        title: title,\n        body: form,\n    }).then(function(modal) {\n        modal.setLarge();\n        modal.show();\n        switch (type) {\n            case 'FileinfoForm':\n            case 'FileinfoFormSave':\n                initPersonButtonListener();\n                addRemoveTagListener('storedperson');\n                initSetPreferenceListener(modal);\n                addInputFieldInputListener('stored', 'tags');\n                break;\n            case 'PreferenceForm':\n            case 'PreferenceFormSave':\n                // Add additional form listener(s) and special behaviour.\n                initPersonButtonListener();\n                addRemoveTagListener('storedperson');\n                addInputFieldInputListener('stored', 'tags');\n                break;\n        }\n        modal.getRoot().on(ModalEvents.hidden, function() {\n            modal.destroy();\n        });\n        modal.getRoot().on(ModalEvents.save, function() {\n            saveForm(modal, element, options, type, title);\n        });\n        return; // For eslint.\n    }).catch(function(error) {\n        window.console.debug(error);\n    });\n};\n\nconst saveForm = (modal, element, options, type, title) => {\n    var formData = modal.getRoot().find('form').serialize();\n    let saveargs = {\n        courseid: element.dataset.courseid,\n        formtype: type + 'Save',\n        params: JSON.stringify(Object.assign(options, {settings: formData}))\n    };\n    let context = element.dataset.context;\n    var formSubmit = Fragment.loadFragment('local_oer', 'formdata', context, saveargs);\n    formSubmit.done(function(response) {\n        if (response.indexOf('<form') !== -1) {\n            modal.destroy();\n            if (options.hasOwnProperty('preference')) {\n                delete options.preference;\n                replaceFileInfo(Service.loadFile(options.contenthash));\n            }\n            showFormModal(formSubmit, type, title, options);\n        } else if (type === 'FileinfoForm') {\n            replaceFileInfo(Service.loadFile(options.contenthash));\n        } else if (type === 'PreferenceForm') {\n            prepareFiles(Service.loadFiles());\n        }\n    }).catch(function(error) {\n        window.console.debug('Form submission failed', error);\n    });\n};\n\nconst replaceFileInfo = (promises) => {\n    promises[0].done(function(response) {\n        let filelist = document.getElementById(\"local-oer-overview-filelist\").innerHTML;\n        let output = JSON.parse(filelist);\n        output.files.forEach(function(file, index) {\n            if (file.contenthash === response.file.contenthash) {\n                output.files[index] = response.file;\n            }\n        });\n        document.getElementById(\"local-oer-overview-filelist\").innerHTML = JSON.stringify(output);\n        showFiles();\n    });\n};\n\n/**\n * Prepare the filecard informations for output.\n *\n * @param {object} promises\n * @param {boolean} init\n */\nexport const prepareFiles = (promises, init) => {\n    promises[0].done(function(response) {\n        document.getElementById(\"local-oer-overview-filelist\").innerHTML = JSON.stringify(response);\n        showFiles(init);\n    });\n};\n\nconst addInputFieldInputListener = (prefix, area) => {\n    showTags(prefix + area);\n    document.getElementById('id_' + area).addEventListener('keypress', function(e) {\n        if (e.key !== 'Enter') {\n            return;\n        }\n        addStoredTag(prefix, area);\n        showTags(prefix + area);\n    });\n    addRemoveTagListener(prefix + area);\n};\n\nconst addStoredTag = (prefix, tagarea) => {\n    let select = document.getElementById('id_' + tagarea);\n    let tag = select.value;\n    tag = tag.replace(',', ' ').trim();\n    let tags = document.querySelector('[name=\"' + prefix + tagarea + '\"]').value;\n    document.getElementById('id_' + tagarea).value = '';\n    if (!tags.includes(tag)) {\n        if (tags === '') {\n            document.querySelector('[name=\"' + prefix + tagarea + '\"]').value = tag;\n        } else {\n            document.querySelector('[name=\"' + prefix + tagarea + '\"]').value = tags + ',' + tag;\n        }\n    }\n};\n\nconst addRemoveTagListener = (tagarea) => {\n    document.getElementById('local_oer_' + tagarea + '_tagarea').addEventListener('click', function(e) {\n        if (e.target.dataset.name !== tagarea) {\n            return;\n        }\n        if (tagarea === 'storedperson') {\n            removePerson(e.target.dataset);\n        } else {\n            let name = e.target.dataset.value;\n            let tags = document.querySelector('[name=\"' + tagarea + '\"]').value.split(',');\n            let result = [];\n            tags.forEach(function(tag) {\n                if (tag !== '' && tag !== name) {\n                    result.push(tag);\n                }\n            });\n            document.querySelector('[name=\"' + tagarea + '\"]').value = result.join(',');\n            showTags(tagarea);\n        }\n    });\n};\n\nconst showTags = (tagarea) => {\n    let entries = document.querySelector('[name=\"' + tagarea + '\"]').value;\n    let tags = {tags: []};\n    if (entries.length > 0) {\n        entries = entries.split(',');\n        entries.forEach(function(entry) {\n            tags.tags.push({tagarea: tagarea, tagvalue: entry, tag: entry});\n        });\n    } else {\n        tags = false;\n    }\n\n    Templates.render('local_oer/tags', tags)\n        .then(function(html, js) {\n            Templates.replaceNodeContents('#local_oer_' + tagarea + '_tagarea', html, js);\n            return; // For eslint.\n        }).fail(function(e) {\n            window.console.log(e);\n        }\n    );\n};\n\nconst initSetPreferenceListener = (modal) => {\n    let button = document.getElementById(\"local_oer_preferenceResetButton\");\n    if (button === null) {\n        return;\n    }\n\n    button.addEventListener(\"click\", function(action) {\n        action.preventDefault();\n        let options = {\n            contenthash: button.dataset.contenthash,\n            preference: button.dataset.preference\n        };\n        let element = document.getElementById(\"local_oer_files_main_area\");\n        saveForm(modal, element, options, 'FileinfoForm', 'FileinfoForm');\n    });\n};\n\nconst initPersonButtonListener = () => {\n    let button = document.getElementById(\"local_oer_addPersonButton\");\n    if (button === null) {\n        return;\n    }\n\n    showPersons();\n\n    button.addEventListener(\"click\", function(action) {\n        action.preventDefault();\n        showPersonForm();\n    });\n};\n\nconst showPersonForm = () => {\n    let context = document.getElementById(\"local_oer_files_main_area\").dataset.context;\n    let form = Fragment.loadFragment('local_oer', 'personform', context, []);\n    form.done(function() {\n        let title = Str.get_string('addpersonbtn', 'local_oer');\n        title.done(function(localizedTitle) {\n            ModalFactory.create({\n                type: ModalFactory.types.SAVE_CANCEL,\n                title: localizedTitle,\n                body: form,\n            }).then(function(modal) {\n                modal.setSaveButtonText(localizedTitle);\n                modal.getRoot().on(ModalEvents.hidden, function() {\n                    modal.destroy();\n                });\n                modal.getRoot().on(ModalEvents.save, function() {\n                    let formData = modal.getRoot().find('form').serialize();\n                    let fields = formData.split('&');\n                    let role = '';\n                    let firstname = '';\n                    let lastname = '';\n                    fields.forEach(function(field) {\n                        let pair = field.split('=');\n                        let key = pair[0];\n                        let value = pair[1];\n                        switch (key) {\n                            case 'role':\n                                role = value;\n                                break;\n                            case 'firstname':\n                                firstname = value;\n                                break;\n                            case 'lastname':\n                                lastname = value;\n                                break;\n                        }\n                    });\n                    let name = {\n                        role: role,\n                        firstname: firstname,\n                        lastname: lastname,\n                    };\n                    addPerson(name);\n\n                });\n                modal.show();\n                return; // For eslint.\n            }).catch(function(error) {\n                window.console.debug(error);\n            });\n        });\n    });\n};\n\nconst addPerson = (person) => {\n    let names = document.querySelector('[name=\"storedperson\"]').value;\n    if (names !== '') {\n        names = JSON.parse(names);\n        let found = false;\n        names.persons.forEach(function(storedname) {\n            if (person.role === storedname.role\n                && person.firstname === storedname.firstname\n                && person.lastname === storedname.lastname) {\n                found = true;\n            }\n        });\n        if (!found) {\n            names.persons.push(person);\n            document.querySelector('[name=\"storedperson\"]').value = JSON.stringify(names);\n        }\n    } else {\n        document.querySelector('[name=\"storedperson\"]').value = JSON.stringify({persons: [person]});\n    }\n    showPersons();\n};\n\nconst removePerson = (person) => {\n    let entries = document.querySelector('[name=\"storedperson\"]').value;\n    if (entries === '') {\n        return;\n    }\n    entries = JSON.parse(entries);\n    let persons = {persons: []};\n    entries.persons.forEach(function(storedperson) {\n        if (person.role === storedperson.role\n            && person.firstname === storedperson.firstname\n            && person.lastname === storedperson.lastname) {\n            // Skip this person.\n        } else {\n            persons.persons.push(storedperson);\n        }\n    });\n    document.querySelector('[name=\"storedperson\"]').value = JSON.stringify(persons);\n    showPersons();\n};\n\nconst showPersons = () => {\n    let entries = document.querySelector('[name=\"storedperson\"]').value;\n    if (entries === '') {\n        return;\n    }\n    let strings = [\n        {\n            key: 'author',\n            component: 'local_oer'\n        },\n        {\n            key: 'publisher',\n            component: 'local_oer',\n        }\n    ];\n    Str.get_strings(strings).then(function(results) {\n        entries = JSON.parse(entries);\n        let persons = {persons: []};\n        entries.persons.forEach(function(person) {\n            let localizedrole = results[0];\n            switch (person.role) {\n                case 'Author':\n                    localizedrole = results[0];\n                    break;\n                case 'Publisher':\n                    localizedrole = results[1];\n                    break;\n            }\n\n            persons.persons.push({\n                role: person.role,\n                firstname: person.firstname,\n                lastname: person.lastname,\n                name: localizedrole + ': ' + person.firstname + ' ' + person.lastname\n            });\n        });\n        Templates.render('local_oer/persons', persons)\n            .then(function(html, js) {\n                Templates.replaceNodeContents('#local_oer_storedperson_tagarea', html, js);\n                return; // For eslint.\n            }).fail(function(e) {\n                window.console.log(e);\n            }\n        );\n        return; // For eslint.\n    }).fail(function(e) {\n            window.console.debug(e);\n        }\n    );\n};\n\nconst showPagination = () => {\n    let courseid = document.getElementById(\"local_oer_files_main_area\").dataset.courseid;\n    let filecount = parseInt(localStorage.getItem('local-oer-pagination-filecount-' + courseid), 10);\n    let filelist = document.getElementById(\"local-oer-overview-filelist\").innerHTML;\n    let output = JSON.parse(filelist);\n    let filemax = output.files.length;\n    if (isNaN(filecount)) {\n        filecount = filemax;\n    }\n    let selected = localStorage.getItem('local-oer-pagination-selected-' + courseid);\n    let page = parseInt(localStorage.getItem('local-oer-pagination-current-' + courseid), 10);\n    let pages = 1;\n    if (selected !== \"all\") {\n        if (selected === null) {\n            selected = \"8\";\n        }\n        let amount = parseInt(selected, 10);\n        pages = Math.ceil(filecount / amount);\n    }\n    let result = [];\n    if (isNaN(page)) {\n        page = 1;\n    }\n    if (page > pages) {\n        localStorage.setItem('local-oer-pagination-current-' + courseid, \"1\");\n        page = 1;\n    }\n    if (pages <= 10) {\n        for (let i = 1; i <= pages; i++) {\n            result.push({page: i, active: i === page, disabled: false});\n        }\n    } else {\n        // These two cases have both 7 elements, so the length will not fluctuate when changing elements by << or >>;\n        if (page < 3 || page > (pages - 2)) {\n            result.push({page: 1, active: page === 1, disabled: false});\n            result.push({page: 2, active: page === 2, disabled: false});\n            result.push({page: 3, active: page === 3, disabled: false});\n            result.push({page: \"..\", active: false, disabled: true});\n            result.push({page: pages - 2, active: page === (pages - 2), disabled: false});\n            result.push({page: pages - 1, active: page === (pages - 1), disabled: false});\n            result.push({page: pages, active: page === pages, disabled: false});\n        } else if (page === 3) {\n            result.push({page: 1, active: false, disabled: false});\n            result.push({page: 2, active: false, disabled: false});\n            result.push({page: 3, active: true, disabled: false});\n            result.push({page: 4, active: false, disabled: false});\n            result.push({page: \"..\", active: false, disabled: true});\n            result.push({page: pages - 1, active: page === (pages - 1), disabled: false});\n            result.push({page: pages, active: page === pages, disabled: false});\n        } else if (page === (pages - 2)) {\n            result.push({page: 1, active: false, disabled: false});\n            result.push({page: 2, active: false, disabled: false});\n            result.push({page: \"..\", active: false, disabled: true});\n            result.push({page: pages - 3, active: false, disabled: false});\n            result.push({page: pages - 2, active: true, disabled: false});\n            result.push({page: pages - 1, active: false, disabled: false});\n            result.push({page: pages, active: page === pages, disabled: false});\n        } else {\n            result.push({page: 1, active: false, disabled: false});\n            result.push({page: \"..\", active: false, disabled: true});\n            result.push({page: page - 1, active: false, disabled: false});\n            result.push({page: page, active: true, disabled: false});\n            result.push({page: page + 1, active: false, disabled: false});\n            result.push({page: \"..\", active: false, disabled: true});\n            result.push({page: pages, active: false, disabled: false});\n        }\n    }\n    let data = {\n        selectoptions: paginationSelectOptions(selected),\n        control: pages !== 1,\n        previous: page > 1,\n        next: page < pages,\n        pages: pages === 1 ? false : result,\n        filecount: filecount,\n        filemax: filemax\n    };\n    Templates.render('local_oer/pagination', data)\n        .then(function(html, js) {\n            Templates.replaceNodeContents('#local-oer-pagination', html, js);\n            addPaginationListeners(pages);\n            return; // For eslint.\n        }).fail(function(error) {\n        window.console.debug(error);\n    });\n};\n\nconst paginationSelectOptions = (selected) => {\n    return [\n        {value: \"4\", selected: selected === \"4\"},\n        {value: \"8\", selected: selected === \"8\"},\n        {value: \"12\", selected: selected === \"12\"},\n        {value: \"16\", selected: selected === \"16\"},\n        {value: \"32\", selected: selected === \"32\"},\n        {value: \"64\", selected: selected === \"64\"},\n        {value: \"all\", selected: selected === \"all\"},\n    ];\n};\n\nconst addPaginationListeners = (pages) => {\n    let courseid = document.getElementById(\"local_oer_files_main_area\").dataset.courseid;\n    let selected = localStorage.getItem('local-oer-pagination-selected-' + courseid);\n    let page = localStorage.getItem('local-oer-pagination-current-' + courseid);\n    if (page === null || page === 'undefined') {\n        localStorage.setItem('local-oer-pagination-current-' + courseid, \"1\");\n    }\n    if (selected === null || selected === 'undefined') {\n        localStorage.setItem('local-oer-pagination-selected-' + courseid, \"8\");\n    }\n    let selectlistener = document.getElementById('local-oer-pagination-select');\n    let pagelistener = document.getElementById('local-oer-pagination-pages');\n\n    selectlistener.addEventListener(\"click\", function(action) {\n        action.preventDefault();\n        let value = action.target.value;\n        localStorage.setItem('local-oer-pagination-selected-' + courseid, value);\n        localStorage.setItem('local-oer-pagination-current-' + courseid, \"1\");\n        showFiles(false);\n    });\n\n    pagelistener.addEventListener(\"click\", function(action) {\n        action.preventDefault();\n        let value = action.target.dataset.page;\n        if (value === undefined || value === '..') {\n            return;\n        }\n        let page = parseInt(localStorage.getItem('local-oer-pagination-current-' + courseid));\n        switch (value) {\n            case 'previous':\n                value = page > 1 ? page - 1 : 1;\n                break;\n            case 'next':\n                value = page < pages ? page + 1 : pages;\n                break;\n        }\n        localStorage.setItem('local-oer-pagination-current-' + courseid, value);\n        showFiles(false);\n    });\n};"],"names":["Service","_interopRequireWildcard","Templates","Config","ModalFactory","ModalEvents","Fragment","Str","showFiles","init","output","getOutputValues","oldSearchInput","document","getElementById","oldSearchValue","value","render","then","html","js","replaceNodeContents","searchInput","focus","fail","error","window","console","debug","showPagination","type","title","options","params","JSON","stringify","courseid","dataset","context","args","formtype","form","loadFragment","done","showFormModal","element","create","types","SAVE_CANCEL","body","modal","setLarge","show","initPersonButtonListener","addRemoveTagListener","initSetPreferenceListener","addInputFieldInputListener","getRoot","on","hidden","destroy","save","saveForm","catch","formData","find","serialize","saveargs","Object","assign","settings","formSubmit","response","indexOf","hasOwnProperty","preference","replaceFileInfo","loadFile","contenthash","prepareFiles","loadFiles","promises","filelist","innerHTML","parse","files","forEach","file","index","prefix","area","showTags","addEventListener","e","key","addStoredTag","tagarea","select","tag","replace","trim","tags","querySelector","includes","target","name","removePerson","split","result","push","join","entries","length","entry","tagvalue","log","button","action","preventDefault","showPersons","showPersonForm","get_string","localizedTitle","setSaveButtonText","fields","role","firstname","lastname","field","pair","addPerson","person","names","found","persons","storedname","storedperson","get_strings","component","results","localizedrole","filecount","parseInt","localStorage","getItem","filemax","isNaN","selected","page","pages","amount","Math","ceil","setItem","i","active","disabled","data","selectoptions","paginationSelectOptions","control","previous","next","addPaginationListeners","selectlistener","pagelistener","undefined"],"mappings":"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"}