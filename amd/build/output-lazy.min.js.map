{"version":3,"file":"output-lazy.min.js","sources":["../src/output-lazy.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Open Educational Resources Plugin\n *\n * @author     Christian Ortner <christian.ortner@tugraz.at>\n * @copyright  2022-2023 Educational Technologies, Graz, University of Technology\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport * as Service from 'local_oer/service-lazy';\nimport * as Templates from \"core/templates\";\nimport * as Config from \"local_oer/config-lazy\";\nimport * as ModalFactory from 'core/modal_factory';\nimport * as ModalEvents from 'core/modal_events';\nimport * as Fragment from 'core/fragment';\nimport * as Str from 'core/str';\nimport Log from 'core/log';\n\n/**\n * Show the files in the browser.\n *\n * @param {boolean} init\n * @param {boolean} keepFocus\n */\n// eslint-disable-next-line space-before-function-paren\nexport const showFiles = async (init, keepFocus) => {\n    const output = Config.getOutputValues(init);\n    const oldSearchInput = document.getElementById('local_oer_searchFilecardsInput');\n    let oldSearchValue = '';\n    if (oldSearchInput !== null) {\n        oldSearchValue = oldSearchInput.value;\n    }\n    const {html, js} = await Templates.renderForPromise('local_oer/files', output);\n    Templates.replaceNodeContents('#local-oer-overview', html, js);\n    const searchInput = document.getElementById('local_oer_searchFilecardsInput');\n    if (keepFocus && searchInput !== null) {\n        // Workaround to fix losing focus of search after Template.replaceNodeContents.\n        // The navigation controls are inside the template and replaced after every search.\n        searchInput.value = oldSearchValue;\n        searchInput.focus();\n    }\n    showPagination();\n};\n\n/**\n * Load a form from the backend and show it in a modal.\n *\n * @param {string} type\n * @param {string} title\n * @param {object} options\n */\nexport const showForm = (type, title, options) => {\n    const params = JSON.stringify(options);\n    const courseid = document.getElementById(\"local_oer_files_main_area\").dataset.courseid;\n    const context = document.getElementById(\"local_oer_files_main_area\").dataset.context;\n    const args = {\n        courseid: courseid,\n        formtype: type,\n        params: params,\n    };\n    const form = Fragment.loadFragment('local_oer', 'formdata', context, args);\n    form.then((data) => {\n        // MDL-0 TODO: Better way to do this?\n        let nosave = data.includes('<input name=\"nosave\" type=\"hidden\" value=\"1\" />');\n        if (nosave !== false) {\n            type = 'nosave';\n        }\n        showFormModal(form, type, title, options);\n        return;\n    }).catch(Log.error);\n};\n\n\n// eslint-disable-next-line space-before-function-paren\nconst showFormModal = async (form, type, title, options) => {\n    const element = document.getElementById(\"local_oer_files_main_area\");\n    const modaltype = type === 'nosave' ? ModalFactory.types.CANCEL : ModalFactory.types.SAVE_CANCEL;\n    const modal = await ModalFactory.create({\n        type: modaltype,\n        title: title,\n        body: form,\n    });\n    modal.setLarge();\n    modal.show();\n    switch (type) {\n        case 'FileinfoForm':\n        case 'FileinfoFormSave':\n            initPersonButtonListener();\n            addRemoveTagListener('storedperson');\n            initSetPreferenceListener(modal);\n            addInputFieldInputListener('stored', 'tags');\n            break;\n        case 'PreferenceForm':\n        case 'PreferenceFormSave':\n            // Add additional form listener(s) and special behaviour.\n            initPersonButtonListener();\n            addRemoveTagListener('storedperson');\n            addInputFieldInputListener('stored', 'tags');\n            break;\n    }\n    modal.getRoot().on(ModalEvents.hidden, () => {\n        modal.destroy();\n    });\n    modal.getRoot().on(ModalEvents.save, () => {\n        saveForm(modal, element, options, type, title);\n    });\n};\n\n// eslint-disable-next-line space-before-function-paren\nconst saveForm = async (modal, element, options, type, title) => {\n    const {html, js} = await Templates.renderForPromise('local_oer/spinner', []);\n    const node = document.querySelectorAll(\"[data-oerid='\" + options.identifier + \"']\");\n    Templates.replaceNodeContents(node, html, js);\n    const formData = modal.getRoot().find('form').serialize();\n    const saveargs = {\n        courseid: element.dataset.courseid,\n        formtype: type + 'Save',\n        params: JSON.stringify(Object.assign(options, {settings: formData}))\n    };\n    const context = element.dataset.context;\n    const formSubmit = Fragment.loadFragment('local_oer', 'formdata', context, saveargs);\n    // eslint-disable-next-line space-before-function-paren\n    formSubmit.then(async (response) => {\n        if (response.indexOf('<form') !== -1) {\n            modal.destroy();\n            if (options.hasOwnProperty('preference')) {\n                delete options.preference;\n                replaceFileInfo(await Service.loadFile(options.identifier));\n            }\n            showFormModal(formSubmit, type, title, options);\n        } else if (type === 'FileinfoForm') {\n            replaceFileInfo(await Service.loadFile(options.identifier));\n        } else if (type === 'PreferenceForm') {\n            prepareFiles(await Service.loadFiles(), true);\n        }\n        return;\n    }).catch(Log.error);\n};\n\nconst replaceFileInfo = (promises) => {\n    promises[0].then((response) => {\n        const filelist = document.getElementById(\"local-oer-overview-filelist\").innerHTML;\n        const output = JSON.parse(filelist);\n        output.files.forEach((file, index) => {\n            if (file.identifier === response.file.identifier) {\n                output.files[index] = response.file;\n            }\n        });\n        document.getElementById(\"local-oer-overview-filelist\").innerHTML = JSON.stringify(output);\n        showFiles(false, true);\n        return;\n    }).catch(Log.error);\n};\n\n/**\n * Prepare the filecard informations for output.\n *\n * @param {object} promises\n * @param {boolean} init\n */\nexport const prepareFiles = (promises, init) => {\n    promises[0].then((response) => {\n        document.getElementById(\"local-oer-overview-filelist\").innerHTML = JSON.stringify(response);\n        showFiles(init, true);\n        return;\n    }).catch(Log.error);\n};\n\nconst addInputFieldInputListener = (prefix, area) => {\n    addRemoveTagListener(prefix + area);\n    showTags(prefix + area);\n    document.getElementById('id_' + area).addEventListener('keypress', (e) => {\n        if (e.key !== 'Enter') {\n            return;\n        }\n        addStoredTag(prefix, area);\n        showTags(prefix + area);\n    });\n};\n\nconst addStoredTag = (prefix, tagarea) => {\n    const select = document.getElementById('id_' + tagarea);\n    let tag = select.value;\n    tag = tag.replace(',', ' ').trim();\n    const tags = document.querySelector('[name=\"' + prefix + tagarea + '\"]').value;\n    document.getElementById('id_' + tagarea).value = '';\n    if (!RegExp('\\\\b' + tag + '\\\\b').test(tags)) {\n        if (tags === '') {\n            document.querySelector('[name=\"' + prefix + tagarea + '\"]').value = tag;\n        } else {\n            document.querySelector('[name=\"' + prefix + tagarea + '\"]').value = tags + ',' + tag;\n        }\n    }\n};\n\nconst addRemoveTagListener = (tagarea) => {\n    document.getElementById('local_oer_' + tagarea + '_tagarea').addEventListener('click', (e) => {\n        if (e.target.dataset.name !== tagarea) {\n            return;\n        }\n        if (tagarea === 'storedperson') {\n            removePerson(e.target.dataset);\n        } else {\n            let name = e.target.dataset.value;\n            let tags = document.querySelector('[name=\"' + tagarea + '\"]').value.split(',');\n            let result = [];\n            tags.forEach((tag) => {\n                if (tag !== '' && tag !== name) {\n                    result.push(tag);\n                }\n            });\n            document.querySelector('[name=\"' + tagarea + '\"]').value = result.join(',');\n            showTags(tagarea);\n        }\n    });\n};\n\n// eslint-disable-next-line space-before-function-paren\nconst showTags = async (tagarea) => {\n    let entries = document.querySelector('[name=\"' + tagarea + '\"]').value;\n    let tags = {tags: []};\n    if (entries.length > 0) {\n        entries = entries.split(',');\n        entries.forEach((entry) => {\n            tags.tags.push({tagarea: tagarea, tagvalue: entry, tag: entry});\n        });\n    }\n    const {html, js} = await Templates.renderForPromise('local_oer/tags', tags);\n    Templates.replaceNodeContents('#local_oer_' + tagarea + '_tagarea', html, js);\n};\n\nconst initSetPreferenceListener = (modal) => {\n    const button = document.getElementById(\"local_oer_preferenceResetButton\");\n    if (button === null) {\n        return;\n    }\n\n    button.addEventListener(\"click\", (action) => {\n        action.preventDefault();\n        let options = {\n            identifier: button.dataset.identifier,\n            preference: button.dataset.preference\n        };\n        let element = document.getElementById(\"local_oer_files_main_area\");\n        saveForm(modal, element, options, 'FileinfoForm', 'FileinfoForm');\n    });\n};\n\nconst initPersonButtonListener = () => {\n    const button = document.getElementById(\"local_oer_addPersonButton\");\n    if (button === null) {\n        return;\n    }\n\n    showPersons();\n\n    button.addEventListener(\"click\", (action) => {\n        action.preventDefault();\n        showPersonForm();\n    });\n};\n\nconst showPersonForm = (setInvalid) => {\n    if (typeof setInvalid === 'undefined') {\n        setInvalid = false;\n    }\n    const creator = document.querySelector('[name=\"creator\"]').value;\n    const context = document.getElementById(\"local_oer_files_main_area\").dataset.context;\n    const form = Fragment.loadFragment('local_oer', 'personform', context, {'creator': creator});\n    // eslint-disable-next-line space-before-function-paren\n    form.then(async () => {\n        const title = await Str.get_string('addpersonbtn', 'local_oer');\n        const modal = await ModalFactory.create({\n            type: ModalFactory.types.SAVE_CANCEL,\n            title: title,\n            body: form,\n        });\n        await modal.setSaveButtonText(title);\n        modal.getRoot().on(ModalEvents.hidden, () => {\n            modal.destroy();\n        });\n        modal.getRoot().on(ModalEvents.save, () => {\n            const formData = modal.getRoot().find('form').serialize();\n            const fields = formData.split('&');\n            let role = '';\n            let firstname = '';\n            let lastname = '';\n            fields.forEach((field) => {\n                let pair = field.split('=');\n                let key = pair[0];\n                let value = pair[1];\n                switch (key) {\n                    case 'role':\n                        role = value;\n                        break;\n                    case 'firstname':\n                        firstname = value;\n                        break;\n                    case 'lastname':\n                        lastname = value;\n                        break;\n                }\n            });\n            const name = {\n                role: role,\n                firstname: firstname,\n                lastname: lastname,\n            };\n            addPerson(name);\n\n        });\n        modal.show();\n        if (setInvalid) {\n            let element = document.getElementById(\"id_firstname\");\n            element.classList.add(\"is-invalid\");\n            element = document.getElementById(\"id_lastname\");\n            element.classList.add(\"is-invalid\");\n        }\n        return; // For eslint.\n    }).catch(Log.error);\n};\n\n/**\n * People to add always have a first- and lastname and role.\n *\n * When already a person is defined with the same role and a full name,\n * first and lastname is added. This variant will be preferred.\n *\n * @param {{role: string, firstname: string, lastname: string}} person\n */\nconst addPerson = (person) => {\n    let names = document.querySelector('[name=\"storedperson\"]').value;\n    if (names !== '') {\n        names = JSON.parse(names);\n        let found = false;\n        let update = false;\n        names.persons.forEach((storedname, key) => {\n            if (person.role === storedname.role\n                && person.firstname === storedname.firstname\n                && person.lastname === storedname.lastname) {\n                found = true;\n            }\n            if (person.role === storedname.role\n                && person.firstname + ' ' + person.lastname === storedname.fullname) {\n                found = true;\n                update = true;\n                names.persons[key].firstname = person.firstname;\n                names.persons[key].lastname = person.lastname;\n            }\n        });\n        // If one of the required fields is empty, reload the form.\n        if (person.firstname === '' || person.lastname === '') {\n            showPersonForm(true);\n            return;\n        } else if (!found) {\n            names.persons.push(person);\n            document.querySelector('[name=\"storedperson\"]').value = JSON.stringify(names);\n        } else if (update) {\n            document.querySelector('[name=\"storedperson\"]').value = JSON.stringify(names);\n        }\n    } else {\n        document.querySelector('[name=\"storedperson\"]').value = JSON.stringify({persons: [person]});\n    }\n    showPersons();\n};\n\nconst removePerson = (person) => {\n    let entries = document.querySelector('[name=\"storedperson\"]').value;\n    if (entries === '') {\n        return;\n    }\n    entries = JSON.parse(entries);\n    const persons = {persons: []};\n    entries.persons.forEach((storedperson) => {\n        if (person.role === storedperson.role\n            && ((person.firstname === storedperson.firstname\n                    && person.lastname === storedperson.lastname)\n                || person.fullname === storedperson.fullname)) {\n            // Skip this person.\n        } else {\n            persons.persons.push(storedperson);\n        }\n    });\n    document.querySelector('[name=\"storedperson\"]').value = JSON.stringify(persons);\n    showPersons();\n};\n\n// eslint-disable-next-line space-before-function-paren\nconst showPersons = async () => {\n    let entries = document.querySelector('[name=\"storedperson\"]').value;\n    if (entries === '') {\n        return;\n    }\n    const roles = JSON.parse(document.querySelector('[name=\"personroletypes\"]').value);\n    let strings = [];\n    roles.forEach((role) => {\n        strings.push({\n            key: role[1],\n            component: role[2],\n        });\n    });\n    const results = await Str.get_strings(strings);\n    entries = JSON.parse(entries);\n    let persons = {persons: []};\n    entries.persons.forEach((person) => {\n        let localizedrole = results[0];\n        roles.forEach((role, index) => {\n            if (role[0] === person.role) {\n                localizedrole = results[index];\n            }\n        });\n        persons.persons.push({\n            role: person.role,\n            firstname: person.firstname,\n            lastname: person.lastname,\n            fullname: person.fullname,\n            name: decodeURI(localizedrole + ': ' +\n                (person.fullname === undefined ?\n                    person.firstname + ' ' + person.lastname : person.fullname))\n        });\n    });\n    renderPersonsTemplate(persons);\n};\n\n// eslint-disable-next-line space-before-function-paren\nconst renderPersonsTemplate = async (persons) => {\n    const {html, js} = await Templates.renderForPromise('local_oer/persons', persons);\n    Templates.replaceNodeContents('#local_oer_storedperson_tagarea', html, js);\n};\n\n// eslint-disable-next-line space-before-function-paren\nconst showPagination = async () => {\n    const courseid = document.getElementById(\"local_oer_files_main_area\").dataset.courseid;\n    // Filecount is the number of elements currently available due to filter restrictions.\n    let filecount = parseInt(localStorage.getItem('local-oer-pagination-filecount-' + courseid), 10);\n    const filelist = document.getElementById(\"local-oer-overview-filelist\").innerHTML;\n    const output = JSON.parse(filelist);\n    const filemax = output.files.length;\n    let selected = localStorage.getItem('local-oer-pagination-selected-' + courseid);\n    let page = parseInt(localStorage.getItem('local-oer-pagination-current-' + courseid), 10);\n    let pages = 1;\n    if (isNaN(filecount)) {\n        filecount = filemax;\n    }\n    if (selected !== \"all\") {\n        if (selected === null) {\n            selected = \"8\";\n        }\n        const amount = parseInt(selected, 10);\n        pages = Math.ceil(filecount / amount);\n    }\n    const result = [];\n    if (isNaN(page)) {\n        page = 1;\n    }\n    if (page > pages) {\n        localStorage.setItem('local-oer-pagination-current-' + courseid, \"1\");\n        page = 1;\n    }\n    if (pages <= 10) {\n        for (let i = 1; i <= pages; i++) {\n            result.push({page: i, active: i === page, disabled: false});\n        }\n    } else {\n        // These two cases have both 7 elements, so the length will not fluctuate when changing elements by << or >>;\n        if (page < 3 || page > (pages - 2)) {\n            result.push({page: 1, active: page === 1, disabled: false});\n            result.push({page: 2, active: page === 2, disabled: false});\n            result.push({page: 3, active: page === 3, disabled: false});\n            result.push({page: \"..\", active: false, disabled: true});\n            result.push({page: pages - 2, active: page === (pages - 2), disabled: false});\n            result.push({page: pages - 1, active: page === (pages - 1), disabled: false});\n            result.push({page: pages, active: page === pages, disabled: false});\n        } else if (page === 3) {\n            result.push({page: 1, active: false, disabled: false});\n            result.push({page: 2, active: false, disabled: false});\n            result.push({page: 3, active: true, disabled: false});\n            result.push({page: 4, active: false, disabled: false});\n            result.push({page: \"..\", active: false, disabled: true});\n            result.push({page: pages - 1, active: page === (pages - 1), disabled: false});\n            result.push({page: pages, active: page === pages, disabled: false});\n        } else if (page === (pages - 2)) {\n            result.push({page: 1, active: false, disabled: false});\n            result.push({page: 2, active: false, disabled: false});\n            result.push({page: \"..\", active: false, disabled: true});\n            result.push({page: pages - 3, active: false, disabled: false});\n            result.push({page: pages - 2, active: true, disabled: false});\n            result.push({page: pages - 1, active: false, disabled: false});\n            result.push({page: pages, active: page === pages, disabled: false});\n        } else {\n            result.push({page: 1, active: false, disabled: false});\n            result.push({page: \"..\", active: false, disabled: true});\n            result.push({page: page - 1, active: false, disabled: false});\n            result.push({page: page, active: true, disabled: false});\n            result.push({page: page + 1, active: false, disabled: false});\n            result.push({page: \"..\", active: false, disabled: true});\n            result.push({page: pages, active: false, disabled: false});\n        }\n    }\n    const data = {\n        selectoptions: paginationSelectOptions(selected),\n        control: pages !== 1,\n        previous: page > 1,\n        next: page < pages,\n        pages: pages === 1 ? false : result,\n        filecount: filecount,\n        filemax: filemax\n    };\n    const {html, js} = await Templates.renderForPromise('local_oer/pagination', data);\n    Templates.replaceNodeContents('#local-oer-pagination', html, js);\n    addPaginationListeners(pages);\n};\n\nconst paginationSelectOptions = (selected) => {\n    return [\n        {value: \"4\", selected: selected === \"4\"},\n        {value: \"8\", selected: selected === \"8\"},\n        {value: \"12\", selected: selected === \"12\"},\n        {value: \"16\", selected: selected === \"16\"},\n        {value: \"32\", selected: selected === \"32\"},\n        {value: \"64\", selected: selected === \"64\"},\n        {value: \"all\", selected: selected === \"all\"},\n    ];\n};\n\nconst addPaginationListeners = (pages) => {\n    let courseid = document.getElementById(\"local_oer_files_main_area\").dataset.courseid;\n    let selected = localStorage.getItem('local-oer-pagination-selected-' + courseid);\n    let page = localStorage.getItem('local-oer-pagination-current-' + courseid);\n    if (page === null || page === 'undefined') {\n        localStorage.setItem('local-oer-pagination-current-' + courseid, \"1\");\n    }\n    if (selected === null || selected === 'undefined') {\n        localStorage.setItem('local-oer-pagination-selected-' + courseid, \"8\");\n    }\n    let selectlistener = document.getElementById('local-oer-pagination-select');\n    let pagelistener = document.getElementById('local-oer-pagination-pages');\n\n    selectlistener.addEventListener(\"change\", (action) => {\n        action.preventDefault();\n        let value = action.target.value;\n        localStorage.setItem('local-oer-pagination-selected-' + courseid, value);\n        localStorage.setItem('local-oer-pagination-current-' + courseid, \"1\");\n        showFiles(false, false);\n    });\n\n    pagelistener.addEventListener(\"click\", (action) => {\n        action.preventDefault();\n        let value = action.target.dataset.page;\n        if (value === undefined || value === '..') {\n            return;\n        }\n        let page = parseInt(localStorage.getItem('local-oer-pagination-current-' + courseid));\n        switch (value) {\n            case 'previous':\n                value = page > 1 ? page - 1 : 1;\n                break;\n            case 'next':\n                value = page < pages ? page + 1 : pages;\n                break;\n        }\n        localStorage.setItem('local-oer-pagination-current-' + courseid, value);\n        showFiles(false, false);\n    });\n};"],"names":["showFiles","async","init","keepFocus","output","Config","getOutputValues","oldSearchInput","document","getElementById","oldSearchValue","value","html","js","Templates","renderForPromise","replaceNodeContents","searchInput","focus","showPagination","type","title","options","params","JSON","stringify","courseid","dataset","context","args","formtype","form","Fragment","loadFragment","then","data","includes","showFormModal","catch","Log","error","element","modaltype","ModalFactory","types","CANCEL","SAVE_CANCEL","modal","create","body","setLarge","show","initPersonButtonListener","addRemoveTagListener","initSetPreferenceListener","addInputFieldInputListener","getRoot","on","ModalEvents","hidden","destroy","save","saveForm","node","querySelectorAll","identifier","formData","find","serialize","saveargs","Object","assign","settings","formSubmit","response","indexOf","hasOwnProperty","preference","replaceFileInfo","Service","loadFile","prepareFiles","loadFiles","promises","filelist","innerHTML","parse","files","forEach","file","index","prefix","area","showTags","addEventListener","e","key","addStoredTag","tagarea","tag","replace","trim","tags","querySelector","RegExp","test","target","name","removePerson","split","result","push","join","entries","length","entry","tagvalue","button","action","preventDefault","showPersons","showPersonForm","setInvalid","creator","Str","get_string","setSaveButtonText","fields","role","firstname","lastname","field","pair","addPerson","classList","add","person","names","found","update","persons","storedname","fullname","storedperson","roles","strings","component","results","get_strings","localizedrole","decodeURI","undefined","renderPersonsTemplate","filecount","parseInt","localStorage","getItem","filemax","selected","page","pages","isNaN","amount","Math","ceil","setItem","i","active","disabled","selectoptions","paginationSelectOptions","control","previous","next","addPaginationListeners","selectlistener","pagelistener"],"mappings":"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"}