{"version":3,"file":"config.min.js","sources":["../src/config.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Open Educational Resources Plugin\n *\n * @author     Christian Ortner <christian.ortner@tugraz.at>\n * @copyright  2022 Educational Technologies, Graz, University of Technology\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport * as UserPreference from 'local_oer/userpreferences';\n\n/**\n * Loads all necessary navigation settings and prepares the data for output.\n * Filter the files.\n * Sort the files.\n * Switch card/list view.\n *\n * @param {boolean} init show different ouptput when no files are found\n * @returns {any}\n */\nexport const getOutputValues = (init) => {\n    let filelist = document.getElementById(\"local-oer-overview-filelist\").innerHTML;\n    let output = JSON.parse(filelist);\n    output.init = init === undefined ? false : init;\n    output.shownavigation = output.files.length > 0;\n    // Filter options.\n    let filters = ['f_all', 'f_upload', 'f_norelease', 'f_ignore', 'f_noignore', 'f_deleted', 'f_section', 'f_released'];\n\n    output.founddeleted = false;\n    output.files.forEach(function(file) {\n        if (file.deleted === 1) {\n            output.founddeleted = true;\n        }\n    });\n\n    let chosenfilterobject = UserPreference.getFilter();\n    let chosenfilter = chosenfilterobject.filter;\n    let additionalvalue = chosenfilterobject.value;\n    filters.forEach(function(filter) {\n        output[filter] = false;\n        if (filter === chosenfilter) {\n            output[filter] = true;\n        }\n    });\n\n    let filteredFiles = [];\n    if (chosenfilter !== 'f_all') {\n        output.init = false;\n        output.files.forEach(function(file) {\n            switch (chosenfilter) {\n                case 'f_upload':\n                    if (file.upload === true) {\n                        filteredFiles.push(file);\n                    }\n                    break;\n                case 'f_norelease':\n                    if (file.upload === false && file.ignore === false) {\n                        filteredFiles.push(file);\n                    }\n                    break;\n                case 'f_ignore':\n                    if (file.ignore === true) {\n                        filteredFiles.push(file);\n                    }\n                    break;\n                case 'f_noignore':\n                    if (file.ignore === false) {\n                        filteredFiles.push(file);\n                    }\n                    break;\n                case 'f_released':\n                    if (file.timeuploadedts > 0) {\n                        filteredFiles.push(file);\n                    }\n                    break;\n                case 'f_deleted':\n                    if (file.deleted === true) {\n                        filteredFiles.push(file);\n                    }\n                    break;\n                case 'f_section':\n                    file.sections.forEach(function(section) {\n                        if (section.sectionname === additionalvalue) {\n                            filteredFiles.push(file);\n                        }\n                    });\n                    break;\n            }\n        });\n        output.files = filteredFiles;\n    }\n\n    let search = document.getElementById('local_oer_searchFilecardsInput');\n    if (search) {\n        let searchValue = search.value;\n        let searchOutput = [];\n        if (searchValue !== '') {\n            output.files.forEach(function(file) {\n                if (file.title.toLowerCase().includes(searchValue.toLowerCase())) {\n                    searchOutput.push(file);\n                }\n            });\n            output.files = searchOutput;\n        }\n    }\n\n    let sortOptions = ['s_default', 's_title_asc', 's_title_desc', 's_mimetype', 's_released'];\n    let chosensort = UserPreference.getSort();\n    sortOptions.forEach(function(option) {\n        output[option] = false;\n        if (option === chosensort) {\n            output[option] = true;\n        }\n    });\n    switch (chosensort) {\n        case 's_default':\n            output.files.sort((a, b) => a.ignore - b.ignore);\n            break;\n        case 's_title_asc':\n            output.files.sort((a, b) => a.title.toLowerCase().localeCompare(b.title.toLowerCase()));\n            break;\n        case 's_title_desc':\n            output.files.sort((b, a) => a.title.toLowerCase().localeCompare(b.title.toLowerCase()));\n            break;\n        case 's_mimetype':\n            output.files.sort((a, b) => a.mimetype.toLowerCase().localeCompare(b.mimetype.toLowerCase()));\n            break;\n        case 's_released':\n            output.files.sort((b, a) => a.timeuploadedts - b.timeuploadedts);\n            break;\n    }\n\n    // After sorting and filtering the files, the pagination will be applied.\n    let courseid = document.getElementById(\"local_oer_files_main_area\").dataset.courseid;\n    let selected = localStorage.getItem('local-oer-pagination-selected-' + courseid);\n    let page = parseInt(localStorage.getItem('local-oer-pagination-current-' + courseid), 10);\n    if (isNaN(page)) {\n        page = 1;\n        localStorage.setItem('local-oer-pagination-current-' + courseid, \"1\");\n    }\n    // Now it gets weird. Reset the page to 1 if oldfiles differ from the current amount of files.\n    let oldfiles = parseInt(localStorage.getItem('local-oer-pagination-filecount-' + courseid), 10);\n    localStorage.setItem('local-oer-pagination-filecount-' + courseid, output.files.length.toString());\n    if (!isNaN(oldfiles) && oldfiles !== output.files.length && page !== 1) {\n        page = 1;\n        localStorage.setItem('local-oer-pagination-current-' + courseid, \"1\");\n    }\n    let shownFiles = [];\n    if (selected !== \"all\") {\n        if (selected === null) {\n            selected = \"8\";\n        }\n        let amount = parseInt(selected, 10);\n        let firstelement = (page - 1) * amount;\n        let lastelement = (page * amount) - 1;\n        output.files.forEach(function(file, index) {\n            if (index >= firstelement && index <= lastelement) {\n                shownFiles.push(file);\n            }\n        });\n        output.files = shownFiles;\n    }\n\n    switch (UserPreference.getLayout()) {\n        case 'list':\n            output.card = false;\n            output.list = true;\n            break;\n        case 'card':\n        default:\n            output.card = true;\n            output.list = false;\n    }\n\n    return output;\n};"],"names":["_getRequireWildcardCache","nodeInterop","WeakMap","cacheBabelInterop","cacheNodeInterop","UserPreference","obj","__esModule","default","cache","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","prototype","hasOwnProperty","call","desc","set","_interopRequireWildcard","_exports","getOutputValues","init","filelist","document","getElementById","innerHTML","output","JSON","parse","undefined","shownavigation","files","length","founddeleted","forEach","file","deleted","chosenfilterobject","getFilter","chosenfilter","filter","additionalvalue","value","filteredFiles","upload","push","ignore","timeuploadedts","sections","section","sectionname","search","searchValue","searchOutput","title","toLowerCase","includes","chosensort","getSort","option","sort","a","b","localeCompare","mimetype","courseid","dataset","selected","localStorage","getItem","page","parseInt","isNaN","setItem","oldfiles","toString","shownFiles","amount","firstelement","lastelement","index","getLayout","card","list"],"mappings":"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"}