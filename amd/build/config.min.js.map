{"version":3,"file":"config.min.js","sources":["../src/config.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Open Educational Resources Plugin\n *\n * @author     Christian Ortner <christian.ortner@tugraz.at>\n * @copyright  2022 Educational Technologies, Graz, University of Technology\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport * as UserPreference from 'local_oer/userpreferences';\n\n/**\n * Loads all necessary navigation settings and prepares the data for output.\n * Filter the files.\n * Sort the files.\n * Switch card/list view.\n *\n * @param {boolean} init show different ouptput when no files are found\n * @returns {any}\n */\nexport const getOutputValues = (init) => {\n    let filelist = document.getElementById(\"local-oer-overview-filelist\").innerHTML;\n    let output = JSON.parse(filelist);\n    output.init = init === undefined ? false : init;\n    output.shownavigation = output.files.length > 0;\n    // Filter options.\n    let filters = ['f_all', 'f_upload', 'f_norelease', 'f_ignore', 'f_noignore', 'f_deleted', 'f_section', 'f_released'];\n\n    output.founddeleted = false;\n    output.files.forEach(function (file) {\n        if (file.deleted === 1) {\n            output.founddeleted = true;\n        }\n    });\n\n    let chosenfilterobject = UserPreference.getFilter();\n    let chosenfilter = chosenfilterobject.filter;\n    let additionalvalue = chosenfilterobject.value;\n    filters.forEach(function (filter) {\n        output[filter] = false;\n        if (filter === chosenfilter) {\n            output[filter] = true;\n        }\n    });\n\n    let filteredFiles = [];\n    if (chosenfilter !== 'f_all') {\n        output.init = false;\n        output.files.forEach(function (file) {\n            switch (chosenfilter) {\n                case 'f_upload':\n                    if (file.upload === true) {\n                        filteredFiles.push(file);\n                    }\n                    break;\n                case 'f_norelease':\n                    if (file.upload === false && file.ignore === false) {\n                        filteredFiles.push(file);\n                    }\n                    break;\n                case 'f_ignore':\n                    if (file.ignore === true) {\n                        filteredFiles.push(file);\n                    }\n                    break;\n                case 'f_noignore':\n                    if (file.ignore === false) {\n                        filteredFiles.push(file);\n                    }\n                    break;\n                case 'f_released':\n                    if (file.timeuploadedts > 0) {\n                        filteredFiles.push(file);\n                    }\n                    break;\n                case 'f_deleted':\n                    if (file.deleted === true) {\n                        filteredFiles.push(file);\n                    }\n                    break;\n                case 'f_section':\n                    file.sections.forEach(function (section) {\n                        if (section.sectionname === additionalvalue) {\n                            filteredFiles.push(file);\n                        }\n                    });\n                    break;\n            }\n        });\n        output.files = filteredFiles;\n    }\n\n    let search = document.getElementById('local_oer_searchFilecardsInput');\n    if (search) {\n        let searchValue = search.value;\n        let searchOutput = [];\n        if (searchValue !== '') {\n            output.files.forEach(function (file) {\n                if (file.title.toLowerCase().includes(searchValue.toLowerCase())) {\n                    searchOutput.push(file);\n                }\n            });\n            output.files = searchOutput;\n        }\n    }\n\n    let sortOptions = ['s_default', 's_title_asc', 's_title_desc', 's_mimetype', 's_released',];\n    let chosensort = UserPreference.getSort();\n    sortOptions.forEach(function (option) {\n        output[option] = false;\n        if (option === chosensort) {\n            output[option] = true;\n        }\n    });\n    switch (chosensort) {\n        case 's_default':\n            output.files.sort((a, b) => a.ignore - b.ignore);\n            break;\n        case 's_title_asc':\n            output.files.sort((a, b) => a.title.toLowerCase().localeCompare(b.title.toLowerCase()));\n            break;\n        case 's_title_desc':\n            output.files.sort((b, a) => a.title.toLowerCase().localeCompare(b.title.toLowerCase()));\n            break;\n        case 's_mimetype':\n            output.files.sort((a, b) => a.mimetype.toLowerCase().localeCompare(b.mimetype.toLowerCase()));\n            break;\n        case 's_released':\n            output.files.sort((b, a) => a.timeuploadedts - b.timeuploadedts);\n            break;\n    }\n\n    // After sorting and filtering the files, the pagination will be applied.\n    let courseid = document.getElementById(\"local_oer_files_main_area\").dataset.courseid;\n    let selected = localStorage.getItem('local-oer-pagination-selected-' + courseid);\n    let page = parseInt(localStorage.getItem('local-oer-pagination-current-' + courseid), 10);\n    if (isNaN(page)) {\n        page = 1;\n        localStorage.setItem('local-oer-pagination-current-' + courseid, \"1\");\n    }\n    // Now it gets weird. Reset the page to 1 if oldfiles differ from the current amount of files.\n    let oldfiles = parseInt(localStorage.getItem('local-oer-pagination-filecount-' + courseid), 10);\n    localStorage.setItem('local-oer-pagination-filecount-' + courseid, output.files.length.toString());\n    if (!isNaN(oldfiles) && oldfiles !== output.files.length && page !== 1) {\n        page = 1;\n        localStorage.setItem('local-oer-pagination-current-' + courseid, \"1\");\n    }\n    let shownFiles = [];\n    if (selected !== \"all\") {\n        if (selected === null) {\n            selected = \"8\";\n        }\n        let amount = parseInt(selected, 10);\n        let firstelement = (page - 1) * amount;\n        let lastelement = (page * amount) - 1;\n        output.files.forEach(function (file, index) {\n            if (index >= firstelement && index <= lastelement) {\n                shownFiles.push(file);\n            }\n        });\n        output.files = shownFiles;\n    }\n\n    switch (UserPreference.getLayout()) {\n        case 'list':\n            output.card = false;\n            output.list = true;\n            break;\n        case 'card':\n        default:\n            output.card = true;\n            output.list = false;\n    }\n\n    return output;\n};"],"names":["init","filelist","document","getElementById","innerHTML","output","JSON","parse","undefined","shownavigation","files","length","founddeleted","forEach","file","deleted","chosenfilterobject","UserPreference","getFilter","chosenfilter","filter","additionalvalue","value","filteredFiles","upload","push","ignore","timeuploadedts","sections","section","sectionname","search","searchValue","searchOutput","title","toLowerCase","includes","chosensort","getSort","option","sort","a","b","localeCompare","mimetype","courseid","dataset","selected","localStorage","getItem","page","parseInt","isNaN","setItem","oldfiles","toString","shownFiles","amount","firstelement","lastelement","index","getLayout","card","list"],"mappings":"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"}