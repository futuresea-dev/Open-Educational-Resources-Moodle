{"version":3,"file":"config.min.js","sources":["../src/config.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Open Educational Resources Plugin\n *\n * @author     Christian Ortner <christian.ortner@tugraz.at>\n * @copyright  2022 Educational Technologies, Graz, University of Technology\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport * as UserPreference from 'local_oer/userpreferences';\n\n/**\n * Loads all necessary navigation settings and prepares the data for output.\n * Filter the files.\n * Sort the files.\n * Switch card/list view.\n *\n * @param {boolean} init show different ouptput when no files are found\n * @returns {any}\n */\nexport const getOutputValues = (init) => {\n    const filelist = document.getElementById(\"local-oer-overview-filelist\").innerHTML;\n    const output = JSON.parse(filelist);\n    output.init = init === undefined ? false : init;\n    output.shownavigation = output.files.length > 0;\n    // Filter options.\n    const filters = ['f_all', 'f_upload', 'f_norelease', 'f_ignore', 'f_noignore', 'f_deleted', 'f_origin', 'f_released'];\n\n    output.founddeleted = false;\n    output.files.forEach(function(file) {\n        if (file.deleted === 1) {\n            output.founddeleted = true;\n        }\n    });\n\n    const chosenfilterobject = UserPreference.getFilter();\n    const chosenfilter = chosenfilterobject.filter;\n    const additionalvalue = chosenfilterobject.value;\n    filters.forEach(function(filter) {\n        output[filter] = false;\n        if (filter === chosenfilter) {\n            output[filter] = true;\n        }\n    });\n\n    let countelements = {\n        \"f_all\": output.files.length,\n        \"f_upload\": 0,\n        \"f_norelease\": 0,\n        \"f_ignore\": 0,\n        \"f_noignore\": 0,\n        \"f_released\": 0,\n        \"f_deleted\": 0,\n        // Origins are counted in the origin property.\n    };\n    // MDL-0 TODO: there has to be a better way to calculate this?\n    output.files.forEach(function(file) {\n        if (file.upload === true && file.timeuploadedts === 0) {\n            countelements.f_upload++;\n        }\n        if (file.upload === false && file.ignore === false) {\n            countelements.f_norelease++;\n        }\n        if (file.ignore === true) {\n            countelements.f_ignore++;\n        }\n        if (file.ignore === false) {\n            countelements.f_noignore++;\n        }\n        if (file.timeuploadedts > 0) {\n            countelements.f_released++;\n        }\n        if (file.deleted === true) {\n            countelements.f_deleted++;\n        }\n        file.origins.forEach(function(origin) {\n            output.origin.forEach(function(globalorigin, key) {\n                if (globalorigin.origin === origin.origin) {\n                    if (typeof output.origin[key].count !== \"undefined\") {\n                        output.origin[key].count++;\n                    } else {\n                        output.origin[key].count = 1;\n                    }\n                }\n            });\n        });\n    });\n    output.countelements = countelements;\n\n    const filteredFiles = [];\n    if (chosenfilter !== 'f_all') {\n        output.init = false;\n        output.files.forEach(function(file) {\n            switch (chosenfilter) {\n                case 'f_upload':\n                    if (file.upload === true && file.timeuploadedts === 0) {\n                        filteredFiles.push(file);\n                    }\n                    break;\n                case 'f_norelease':\n                    if (file.upload === false && file.ignore === false) {\n                        filteredFiles.push(file);\n                    }\n                    break;\n                case 'f_ignore':\n                    if (file.ignore === true) {\n                        filteredFiles.push(file);\n                    }\n                    break;\n                case 'f_noignore':\n                    if (file.ignore === false) {\n                        filteredFiles.push(file);\n                    }\n                    break;\n                case 'f_released':\n                    if (file.timeuploadedts > 0) {\n                        filteredFiles.push(file);\n                    }\n                    break;\n                case 'f_deleted':\n                    if (file.deleted === true) {\n                        filteredFiles.push(file);\n                    }\n                    break;\n                case 'f_origin':\n                    file.origins.forEach(function(origin) {\n                        if (origin.origin === additionalvalue) {\n                            filteredFiles.push(file);\n                        }\n                    });\n                    break;\n            }\n        });\n        output.files = filteredFiles;\n    }\n\n    const search = document.getElementById('local_oer_searchFilecardsInput');\n    if (search) {\n        const searchValue = search.value;\n        const searchOutput = [];\n        if (searchValue !== '') {\n            output.files.forEach(function(file) {\n                if (file.title.toLowerCase().includes(searchValue.toLowerCase())) {\n                    searchOutput.push(file);\n                }\n            });\n            output.files = searchOutput;\n        }\n    }\n\n    const sortOptions = ['s_default', 's_title_asc', 's_title_desc', 's_mimetype', 's_released'];\n    const chosensort = UserPreference.getSort();\n    sortOptions.forEach(function(option) {\n        output[option] = false;\n        if (option === chosensort) {\n            output[option] = true;\n        }\n    });\n    switch (chosensort) {\n        case 's_default':\n            output.files.sort((a, b) => a.ignore - b.ignore);\n            break;\n        case 's_title_asc':\n            output.files.sort((a, b) => a.title.toLowerCase().localeCompare(b.title.toLowerCase()));\n            break;\n        case 's_title_desc':\n            output.files.sort((b, a) => a.title.toLowerCase().localeCompare(b.title.toLowerCase()));\n            break;\n        case 's_mimetype':\n            output.files.sort((a, b) => a.mimetype.toLowerCase().localeCompare(b.mimetype.toLowerCase()));\n            break;\n        case 's_released':\n            output.files.sort((b, a) => a.timeuploadedts - b.timeuploadedts);\n            break;\n    }\n\n    // After sorting and filtering the files, the pagination will be applied.\n    const courseid = document.getElementById(\"local_oer_files_main_area\").dataset.courseid;\n    let selected = localStorage.getItem('local-oer-pagination-selected-' + courseid);\n    let page = parseInt(localStorage.getItem('local-oer-pagination-current-' + courseid), 10);\n    if (isNaN(page)) {\n        page = 1;\n        localStorage.setItem('local-oer-pagination-current-' + courseid, \"1\");\n    }\n    // Now it gets weird. Reset the page to 1 if oldfiles differ from the current amount of files.\n    const oldfiles = parseInt(localStorage.getItem('local-oer-pagination-filecount-' + courseid), 10);\n    localStorage.setItem('local-oer-pagination-filecount-' + courseid, output.files.length.toString());\n    if (!isNaN(oldfiles) && oldfiles !== output.files.length && page !== 1) {\n        page = 1;\n        localStorage.setItem('local-oer-pagination-current-' + courseid, \"1\");\n    }\n    const shownFiles = [];\n    if (selected !== \"all\") {\n        if (selected === null) {\n            selected = \"8\";\n        }\n        const amount = parseInt(selected, 10);\n        const firstelement = (page - 1) * amount;\n        const lastelement = (page * amount) - 1;\n        output.files.forEach(function(file, index) {\n            if (index >= firstelement && index <= lastelement) {\n                shownFiles.push(file);\n            }\n        });\n        output.files = shownFiles;\n    }\n\n    switch (UserPreference.getLayout()) {\n        case 'list':\n            output.card = false;\n            output.list = true;\n            break;\n        case 'card':\n        default:\n            output.card = true;\n            output.list = false;\n    }\n\n    if (chosenfilter === 'f_origin') {\n        output.origin.forEach(function(origin) {\n            if (additionalvalue === origin.origin) {\n                output.oname = origin.originname;\n            }\n        });\n    }\n    return output;\n};"],"names":["_getRequireWildcardCache","e","WeakMap","r","t","UserPreference","__esModule","default","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","hasOwnProperty","call","i","set","_interopRequireWildcard","_exports","getOutputValues","init","filelist","document","getElementById","innerHTML","output","JSON","parse","undefined","shownavigation","files","length","founddeleted","forEach","file","deleted","chosenfilterobject","getFilter","chosenfilter","filter","additionalvalue","value","countelements","f_all","f_upload","f_norelease","f_ignore","f_noignore","f_released","f_deleted","upload","timeuploadedts","ignore","origins","origin","globalorigin","key","count","filteredFiles","push","search","searchValue","searchOutput","title","toLowerCase","includes","chosensort","getSort","option","sort","b","localeCompare","mimetype","courseid","dataset","selected","localStorage","getItem","page","parseInt","isNaN","setItem","oldfiles","toString","shownFiles","amount","firstelement","lastelement","index","getLayout","card","list","oname","originname"],"mappings":"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"}