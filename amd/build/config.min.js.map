{"version":3,"file":"config.min.js","sources":["../src/config.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Open Educational Resources Plugin\n *\n * @author     Christian Ortner <christian.ortner@tugraz.at>\n * @copyright  2022 Educational Technologies, Graz, University of Technology\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport * as UserPreference from 'local_oer/userpreferences';\n\n/**\n * Loads all necessary navigation settings and prepares the data for output.\n * Filter the files.\n * Sort the files.\n * Switch card/list view.\n *\n * @param {boolean} init show different ouptput when no files are found\n * @returns {any}\n */\nexport const getOutputValues = (init) => {\n    const filelist = document.getElementById(\"local-oer-overview-filelist\").innerHTML;\n    const output = JSON.parse(filelist);\n    output.init = init === undefined ? false : init;\n    output.shownavigation = output.files.length > 0;\n    // Filter options.\n    const filters = ['f_all', 'f_upload', 'f_norelease', 'f_ignore', 'f_noignore', 'f_deleted', 'f_origin', 'f_released'];\n\n    output.founddeleted = false;\n    output.files.forEach(function(file) {\n        if (file.deleted === 1) {\n            output.founddeleted = true;\n        }\n    });\n\n    const chosenfilterobject = UserPreference.getFilter();\n    const chosenfilter = chosenfilterobject.filter;\n    const additionalvalue = chosenfilterobject.value;\n    filters.forEach(function(filter) {\n        output[filter] = false;\n        if (filter === chosenfilter) {\n            output[filter] = true;\n        }\n    });\n\n    let countelements = {\n        \"f_all\": output.files.length,\n        \"f_upload\": 0,\n        \"f_norelease\": 0,\n        \"f_ignore\": 0,\n        \"f_noignore\": 0,\n        \"f_released\": 0,\n        \"f_deleted\": 0,\n        // Origins are counted in the origin property.\n    };\n    // TODO: there has to be a better way to calculate this?\n    output.files.forEach(function(file) {\n        if (file.upload === true) {\n            countelements.f_upload++;\n        }\n        if (file.upload === false && file.ignore === false) {\n            countelements.f_norelease++;\n        }\n        if (file.ignore === true) {\n            countelements.f_ignore++;\n        }\n        if (file.ignore === false) {\n            countelements.f_noignore++;\n        }\n        if (file.timeuploadedts > 0) {\n            countelements.f_released++;\n        }\n        if (file.deleted === true) {\n            countelements.f_deleted++;\n        }\n        file.origins.forEach(function(origin) {\n            output.origin.forEach(function(globalorigin, key) {\n                if (globalorigin.origin === origin.origin) {\n                    if (typeof output.origin[key].count !== \"undefined\") {\n                        output.origin[key].count++;\n                    } else {\n                        output.origin[key].count = 1;\n                    }\n                }\n            });\n        });\n    });\n    output.countelements = countelements;\n\n    const filteredFiles = [];\n    if (chosenfilter !== 'f_all') {\n        output.init = false;\n        output.files.forEach(function(file) {\n            switch (chosenfilter) {\n                case 'f_upload':\n                    if (file.upload === true) {\n                        filteredFiles.push(file);\n                    }\n                    break;\n                case 'f_norelease':\n                    if (file.upload === false && file.ignore === false) {\n                        filteredFiles.push(file);\n                    }\n                    break;\n                case 'f_ignore':\n                    if (file.ignore === true) {\n                        filteredFiles.push(file);\n                    }\n                    break;\n                case 'f_noignore':\n                    if (file.ignore === false) {\n                        filteredFiles.push(file);\n                    }\n                    break;\n                case 'f_released':\n                    if (file.timeuploadedts > 0) {\n                        filteredFiles.push(file);\n                    }\n                    break;\n                case 'f_deleted':\n                    if (file.deleted === true) {\n                        filteredFiles.push(file);\n                    }\n                    break;\n                case 'f_origin':\n                    file.origins.forEach(function(origin) {\n                        if (origin.origin === additionalvalue) {\n                            filteredFiles.push(file);\n                        }\n                    });\n                    break;\n            }\n        });\n        output.files = filteredFiles;\n    }\n\n    const search = document.getElementById('local_oer_searchFilecardsInput');\n    if (search) {\n        const searchValue = search.value;\n        const searchOutput = [];\n        if (searchValue !== '') {\n            output.files.forEach(function(file) {\n                if (file.title.toLowerCase().includes(searchValue.toLowerCase())) {\n                    searchOutput.push(file);\n                }\n            });\n            output.files = searchOutput;\n        }\n    }\n\n    const sortOptions = ['s_default', 's_title_asc', 's_title_desc', 's_mimetype', 's_released'];\n    const chosensort = UserPreference.getSort();\n    sortOptions.forEach(function(option) {\n        output[option] = false;\n        if (option === chosensort) {\n            output[option] = true;\n        }\n    });\n    switch (chosensort) {\n        case 's_default':\n            output.files.sort((a, b) => a.ignore - b.ignore);\n            break;\n        case 's_title_asc':\n            output.files.sort((a, b) => a.title.toLowerCase().localeCompare(b.title.toLowerCase()));\n            break;\n        case 's_title_desc':\n            output.files.sort((b, a) => a.title.toLowerCase().localeCompare(b.title.toLowerCase()));\n            break;\n        case 's_mimetype':\n            output.files.sort((a, b) => a.mimetype.toLowerCase().localeCompare(b.mimetype.toLowerCase()));\n            break;\n        case 's_released':\n            output.files.sort((b, a) => a.timeuploadedts - b.timeuploadedts);\n            break;\n    }\n\n    // After sorting and filtering the files, the pagination will be applied.\n    const courseid = document.getElementById(\"local_oer_files_main_area\").dataset.courseid;\n    let selected = localStorage.getItem('local-oer-pagination-selected-' + courseid);\n    let page = parseInt(localStorage.getItem('local-oer-pagination-current-' + courseid), 10);\n    if (isNaN(page)) {\n        page = 1;\n        localStorage.setItem('local-oer-pagination-current-' + courseid, \"1\");\n    }\n    // Now it gets weird. Reset the page to 1 if oldfiles differ from the current amount of files.\n    const oldfiles = parseInt(localStorage.getItem('local-oer-pagination-filecount-' + courseid), 10);\n    localStorage.setItem('local-oer-pagination-filecount-' + courseid, output.files.length.toString());\n    if (!isNaN(oldfiles) && oldfiles !== output.files.length && page !== 1) {\n        page = 1;\n        localStorage.setItem('local-oer-pagination-current-' + courseid, \"1\");\n    }\n    const shownFiles = [];\n    if (selected !== \"all\") {\n        if (selected === null) {\n            selected = \"8\";\n        }\n        const amount = parseInt(selected, 10);\n        const firstelement = (page - 1) * amount;\n        const lastelement = (page * amount) - 1;\n        output.files.forEach(function(file, index) {\n            if (index >= firstelement && index <= lastelement) {\n                shownFiles.push(file);\n            }\n        });\n        output.files = shownFiles;\n    }\n\n    switch (UserPreference.getLayout()) {\n        case 'list':\n            output.card = false;\n            output.list = true;\n            break;\n        case 'card':\n        default:\n            output.card = true;\n            output.list = false;\n    }\n\n    if (chosenfilter === 'f_origin') {\n        output.origin.forEach(function(origin) {\n            if (additionalvalue === origin.origin) {\n                output.oname = origin.originname;\n            }\n        });\n    }\n    return output;\n};"],"names":["init","filelist","document","getElementById","innerHTML","output","JSON","parse","undefined","shownavigation","files","length","founddeleted","forEach","file","deleted","chosenfilterobject","UserPreference","getFilter","chosenfilter","filter","additionalvalue","value","countelements","upload","f_upload","ignore","f_norelease","f_ignore","f_noignore","timeuploadedts","f_released","f_deleted","origins","origin","globalorigin","key","count","filteredFiles","push","search","searchValue","searchOutput","title","toLowerCase","includes","chosensort","getSort","option","sort","a","b","localeCompare","mimetype","courseid","dataset","selected","localStorage","getItem","page","parseInt","isNaN","setItem","oldfiles","toString","shownFiles","amount","firstelement","lastelement","index","getLayout","card","list","oname","originname"],"mappings":"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"}